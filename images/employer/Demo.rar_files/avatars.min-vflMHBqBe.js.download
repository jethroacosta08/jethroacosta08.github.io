define(["require","exports","tslib","react","external/prop-types","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/style","modules/clean/avatar/viewer_avatar","modules/clean/em_string","modules/clean/react/pass/constants","modules/clean/react/pass/utils","modules/core/browser_detection","modules/core/user_i18n","modules/core/i18n","deep-integrations/platform/server/localization","modules/clean/react/pass/integration/profile_card_popover","external/react-redux","modules/clean/integrations/app_store_lite_modal","modules/clean/integrations/link_service","deep-integrations/profile_card/profile_card_tooltip_content","modules/clean/react/pass/tooltip_helpers","modules/clean/integrations/data/actions","deep-integrations/data/user_settings","modules/clean/integrations/profile_card_tooltip","modules/clean/integrations/data/store","modules/clean/integrations/data/selectors","deep-integrations/async"],function(t,e,o,r,n,a,i,s,l,p,u,c,d,f,v,m,h,g,_,C,I,y,A,E,T,S,P,x){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),r=o.__importDefault(r),n=o.__importStar(n),a=o.__importDefault(a),l=o.__importDefault(l),d=o.__importStar(d),f=o.__importStar(f);var N=(function(t){function e(e,o){var n=t.call(this,e,o)||this;return n.renderAvatarButton=function(){return r.default.createElement("button",{className:"pass-facepile-avatar"},n.getAvatar())},n.state={loadResult:"loaded"},n.onAvatarClick=n.onAvatarClick.bind(n),n}return o.__extends(e,t),e.prototype.onAvatarClick=function(){this.props.logPassEvent(u.EventTypes.PASS_CLICK)},e.prototype.render=function(){var t=this.wrapAvatarWithTooltip(),e="pending"===this.state.loadResult?"react-pass__face-no-display":"react-pass__face-container";return r.default.createElement("div",{className:e},t)},e.prototype.wrapAvatarWithTooltip=function(){var t=this.context.getPopoverGroup(),e=this.props.tooltipCanInitiallyOpen&&this.context.shouldAutoDisplayTooltip();return r.default.createElement(t.popover,{upsellContent:this.getTooltipElement(),profileCard:this.getProfileCardElement(),positioning:"below",positionOffset:9,onClickTrigger:this.onAvatarClick,onMouseOverTrigger:this.props.onMouseEnter,isShowInitially:e},r.default.createElement("div",{className:"react-title-bubble__container"},this.renderAvatarButton()))},e.contextTypes={getPopoverGroup:n.func,shouldAutoDisplayTooltip:n.func},e})(r.default.Component),O=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.isGuestAvatar=function(){var t=this.props.userInfo.userId;return t&&c.AnonymousViewerUtils.isAnonymousUserId(t)},e.prototype.getInitialsColor=function(){var t=this.props.userInfo,e=t.userId,o=t.displayName;return this.isGuestAvatar()?s.colorValueForAvatarName(e):s.colorValueForAvatarName(o)},e.prototype.render=function(){var t=this.props,e=t.integrationStore,o=t.userInfo,n=t.userInfo.displayName,a=p.Emstring.em_snippet(n,10);return r.default.createElement(g.Provider,{store:e},r.default.createElement(T.StatefulProfileCardTooltipContent,{displayName:a,seenState:y.buildSeenStateMessage(o),avatarColor:this.getInitialsColor(),localization:m.localization}))},e})(r.default.Component);e.UserAvatarPassiveTooltipContent=O;var w=(function(t){function e(e,o){var r=t.call(this,e,o)||this;return r.showAppStoreLiteModal=function(){r.context.getPopoverGroup().closePortal(),_.showAppStoreLiteModal(r.props.integrationInfo.userId)},r.connectService=function(t){r.context.getPopoverGroup().closePortal();var e=P.isConnectServiceLandingPagesEnabled(r.context.getIntegrationStore().getState());return C.linkService(r.props.integrationInfo.userId,t,e).then(function(){r.context.getIntegrationStore().dispatch(A.fetchListServices())})},r.state={loadResult:null==r.props.userInfo.photoUrl?"loaded":"pending"},r.boundOnLoad=r.onFinalize.bind(r,!0),r.boundOnError=r.onFinalize.bind(r,!1),r}return o.__extends(e,t),e.prototype.isGuestAvatar=function(){return this.props.userInfo.userId&&c.AnonymousViewerUtils.isAnonymousUserId(this.props.userInfo.userId)},e.prototype.getUserAvatarProps=function(){var t=this.props.userInfo,e=t.displayName,n=t.isActive,a=this.isGuestAvatar()?c.AnonymousViewerUtils.getAnonymousViewerInitials(e):f.getInitials(e),s={dimension:32,initials:a,color:this.getInitialsColor(),shape:"CIRCLE"};n||(s.optionalClass="c-avatar--inactive",d.msie&&(s.color="#7B8994"));var l=r.default.createElement(i.InitialsAvatar,o.__assign({},s));return n||(l=r.default.createElement("span",{className:"c-avatar-initials-wrapper"},l)),{alt:e,dimension:32,photoUrl:this.getEffectivePhotoUrl(),defaultAvatar:l,optionalClass:s.optionalClass,shape:"CIRCLE",onLoad:this.boundOnLoad,onError:this.boundOnError}},e.prototype.getEffectivePhotoUrl=function(){return"error"===this.state.loadResult?void 0:this.props.userInfo.photoUrl},e.prototype.getAvatar=function(){var t=this.getUserAvatarProps();return this.props.userInfo.isViewer&&"error"!==this.state.loadResult?r.default.createElement(l.default,o.__assign({},t)):r.default.createElement(a.default,o.__assign({},t))},e.prototype.onAvatarClick=function(){t.prototype.onAvatarClick.call(this);var e=this.context.getIntegrationStore(),o=["tooltip_click_for_more","tooltip_click_for_more_auto_display"].filter(function(t){return!S.isPromptDismissed(e.getState(),t)}).map(function(t){return{".tag":t}});o.length>0&&e.dispatch(E.dismissPrompts(o))},e.prototype.onFinalize=function(t){if(null!=this.getEffectivePhotoUrl()){this.setState({loadResult:t?"loaded":"error"});var e=this.props,o=e.userInfo.photoUrl,r=e.onLoad;r&&o&&r(o)}},e.prototype.getInitialsColor=function(){return this.isGuestAvatar()?s.colorValueForAvatarName(this.props.userInfo.userId):s.colorValueForAvatarName(this.props.userInfo.displayName)},e.prototype.getTooltipElement=function(){var t=this.props.userInfo,e=p.Emstring.em_snippet(t.displayName,10);return r.default.createElement(g.Provider,{store:this.context.getIntegrationStore()},r.default.createElement(T.StatefulProfileCardTooltipContent,{displayName:e,seenState:y.buildSeenStateMessage(t),avatarColor:this.getInitialsColor(),localization:m.localization}))},e.prototype.getProfileCardElement=function(){var t=this.props,e=t.userInfo,o=t.integrationInfo;return r.default.createElement(g.Provider,{store:this.context.getIntegrationStore()},r.default.createElement(h.ProfileCardPopover,{userInfo:e,fileInfo:{".tag":"file",id:x.fulfilled(o.fileId),name:o.fileName},avatarColor:this.getInitialsColor(),onConnectService:this.connectService,onConnectServices:this.showAppStoreLiteModal,logEvent:this.context.logEvent(),entryPoint:"file_preview",performanceTimer:this.context.performanceTimer(),reportError:this.context.reportError()}))},e.contextTypes={getApiV2Client:n.func,getDataStore:n.func,getIntegrationStore:n.func,getPopoverGroup:n.func,shouldAutoDisplayTooltip:n.func,performanceTimer:n.func,logEvent:n.func,reportError:n.func},e})(N);e.UserAvatar=w;var M=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.getTooltipMessage=function(){return v.ungettext("%(display_num)s other","%(display_num)s others",this.getDisplayNum()).format({display_num:this.getMoreFacepileCountText()})},e.prototype.getDisplayNum=function(){return this.props.moreFacepileCount>=u.MAX_OVERFLOW_BUTTON_INDICATOR?u.MAX_OVERFLOW_BUTTON_INDICATOR:this.props.moreFacepileCount},e.prototype.getMoreFacepileCountText=function(){return this.props.moreFacepileCount>=u.MAX_OVERFLOW_BUTTON_INDICATOR?u.MAX_OVERFLOW_BUTTON_INDICATOR+"+":""+this.props.moreFacepileCount},e.prototype.getAvatar=function(){return r.default.createElement(i.InitialsAvatar,{alt:this.getMoreFacepileCountText(),dimension:32,initials:this.getMoreFacepileCountText(),color:"#7B8994",shape:"CIRCLE",optionalClass:"c-avatar--overflow"})},e.prototype.onAvatarClick=function(){t.prototype.onAvatarClick.call(this),this.props.openShareModal()},e.prototype.getTooltipElement=function(){return r.default.createElement(I.OverflowTooltipContent,{overflowMessage:this.getTooltipMessage()})},e.prototype.getProfileCardElement=function(){return null},e})(N);e.OverflowAvatar=M});
//# sourceMappingURL=avatars.min.js-vflAivPKY.map
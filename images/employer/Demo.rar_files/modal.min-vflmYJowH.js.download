define(["require","exports","tslib","react","external/lodash","modules/clean/analytics","modules/clean/auth/login/form","modules/clean/auth/login_or_register/types","modules/clean/auth/register/form","modules/clean/auth_event_logger","modules/clean/growth/experiments/logger","modules/clean/react/comments2/data/logger","modules/clean/react/css","modules/clean/react/modal","modules/clean/react_format","modules/clean/react/welcome_modal","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","spectrum/button","spectrum/modal"],function(e,o,t,n,a,s,r,i,l,c,d,m,u,g,p,_,f,h,v,M,O,L){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),n=t.__importDefault(n),d=t.__importDefault(d),m=t.__importStar(m),f=t.__importStar(f);var C,b=(C={},C[i.CommentTextVariant.DEFAULT]="default-variant",C[i.CommentTextVariant.POST]="post-comment-variant",C[i.CommentTextVariant.SUBSCRIBE]="subscribe-variant",C);o.TestOnlyCommentTextVariantCssClass=b;var E=function(e){var o=e.mode,t=e.onHeaderLinkClick,a=n.default.createElement(O.Button,{className:"button-as-link toggle-form-link",onClick:t,variant:"styleless"}),s=o===i.Mode.LOGIN?v._("Download and save directly to your Dropbox by signing in, or <a>create a free account</a>"):v._("Download and save to your Dropbox by creating a free account, or <a>sign in</a>");return n.default.createElement("span",null,p.reactFormat(s,{a:a}))},N=function(e){var o,t=e.className,a=e.commentTextVariant,s=e.mode;switch(a){case i.CommentTextVariant.POST:o=s===i.Mode.LOGIN?v._("To post your comment, sign in to Dropbox."):v._("To post your comment, create a free Dropbox account.");break;case i.CommentTextVariant.SUBSCRIBE:o=s===i.Mode.LOGIN?v._("To subscribe to this file, sign in to Dropbox."):v._("To subscribe to this file, create a free Dropbox account.");break;default:o=s===i.Mode.LOGIN?v._("To continue, sign in to Dropbox."):v._("To continue, create a free Dropbox account.")}return n.default.createElement("div",{className:"text-variant "+t},o)};o.TestOnlyCommentsHeader=N;var D=function(e){var o=e.mode,t=e.onFooterLinkClick;return n.default.createElement(O.Button,{className:"button-as-link",onClick:t,variant:"styleless"},o===i.Mode.LOGIN?v._("New to Dropbox? Create a free account!"):v._("Have a Dropbox account? Sign in."))},k=function(e){var o=e.isDownload,t=e.onFooterLinkClick;return n.default.createElement(O.Button,{className:"button-as-link close-link",onClick:t,variant:"styleless"},o?v._("No thanks, continue to download"):v._("No thanks, continue to view"))},w=(function(e){function o(o){var t=e.call(this,o)||this;return t.logWebActivityOnce=a.once(function(e){s.WebMiscActivityLogger.log(e,{auth_google:!0})}),t.logAuthIntent=function(){t.state.mode===i.Mode.LOGIN?c.AuthEventLogger.log_web_login_intent():c.AuthEventLogger.log_web_signup_intent()},t.renderHeader=function(){var e=t.props.commentParams;return t.props.kind===i.LoginOrRegisterKind.COMMENT?n.default.createElement(N,{className:b[e.variant],commentTextVariant:e.variant,mode:t.state.mode}):n.default.createElement(E,{mode:t.state.mode,onHeaderLinkClick:t.toggleMode})},t.renderFooter=function(){return t.props.kind===i.LoginOrRegisterKind.COMMENT?n.default.createElement(D,{mode:t.state.mode,onFooterLinkClick:t.toggleMode}):n.default.createElement(k,{isDownload:t.props.kind===i.LoginOrRegisterKind.DOWNLOAD&&t.props.downloadAction===i.DownloadAction.DIRECT_DOWNLOAD,onFooterLinkClick:t.onContinueToView})},t.toggleMode=function(e){e.preventDefault(),t.setState(function(e){if(t.props.kind===i.LoginOrRegisterKind.COMMENT){var o=e.mode===i.Mode.LOGIN?"sign_up_modal_toggle_to_sign_up":"sign_up_modal_toggle_to_sign_in";m.logEvent(o,{stream:t.props.commentParams.stream})}return{mode:e.mode===i.Mode.LOGIN?i.Mode.REGISTER:i.Mode.LOGIN}},t.logAuthIntent)},t.onAuthenticateSuccess=function(e){var o=t.state.mode,a=t.props,s=a.downloadAction,r=a.kind;if(o===i.Mode.LOGIN?M.Notify.success(v._("Successfully signed in to Dropbox")):M.Notify.success(v._("Successfully signed up for Dropbox")),t.props.kind===i.LoginOrRegisterKind.COMMENT){var l=o===i.Mode.LOGIN?"sign_up_modal_sign_in_success":"sign_up_modal_sign_up_success";m.logEvent(l,{stream:t.props.commentParams.stream})}t.props.onAuthenticateSuccess(e),r===i.LoginOrRegisterKind.IMMEDIATE||s===i.DownloadAction.DIRECT_DOWNLOAD?o===i.Mode.REGISTER?(d.default.log("sharing","shared_link_welcome_modal_view"),g.Modal.showInstance(n.default.createElement(_.WelcomeModal,{id:"shared-link-welcome-modal"}))):o===i.Mode.LOGIN&&f.reload():t.closeModal()},t.onContinueToView=function(e){e.preventDefault(),e.stopPropagation(),t.props.onContinueToView&&t.props.onContinueToView(),t.closeModal()},t.onCancel=function(e){e&&e.stopPropagation(),t.props.onCancel(),t.closeModal()},t.closeModal=function(e){e&&e.stopPropagation(),g.Modal.close(null)},t.state={mode:o.initialMode||i.Mode.LOGIN},h.assert(!(o.kind===i.LoginOrRegisterKind.COMMENT&&!o.commentParams),"Comment parameters must be provided if calling this modal from comments code"),t}return t.__extends(o,e),o.prototype.componentDidMount=function(){var e=this.props,o=e.downloadAction,t=e.kind;this.logAuthIntent(),t===i.LoginOrRegisterKind.IMMEDIATE?this.logWebActivityOnce("signup_modal-show-upfront"):t===i.LoginOrRegisterKind.DOWNLOAD&&o===i.DownloadAction.DIRECT_DOWNLOAD&&this.logWebActivityOnce("signup_modal-show-download")},o.prototype.render=function(){var e=this.state.mode,o=this.props,t=o.id,a=o.signup_tag;return n.default.createElement(L.Modal,{ariaLabel:"Login or register modal",appElement:document.body,bodyId:t,className:"mc-util-modal mc-util-modal-regular login-or-register-modal",displayCloseButton:!0,onRequestClose:this.onCancel,open:!0,overlayClassName:"file-viewer-modal-overlay",width:500},n.default.createElement("div",{className:"mc-util-modal-header center"},this.renderHeader()),n.default.createElement("div",{className:"mc-util-modal-body"},e===i.Mode.LOGIN&&n.default.createElement(r.LoginForm,{canRedirect:!1,className:"login-form-wrapper",googleLoginProps:{positionBelow:!1},showAppleLogin:this.props.showAppleLogin,appleLoginProps:{positionBelow:!1},maestroStyle:!0,onLoginSuccess:this.onAuthenticateSuccess,rememberMeCheckboxProps:{checked:!0}}),e===i.Mode.REGISTER&&n.default.createElement(l.RegisterForm,{additionalParams:a?{signup_tag:a}:void 0,canRedirect:!1,className:"register-form-wrapper",maestroStyle:!0,onRegisterSuccess:this.onAuthenticateSuccess,tosCheckboxProps:{inline:!1}})),n.default.createElement("div",{className:"mc-util-modal-actions"},this.renderFooter()))},o})(n.default.PureComponent);o.TestOnlyLoginOrRegisterModal=w;var T=u.requireCssWithComponent(w,["/static/css/components/login_or_register_modal-vfl0wwYwD.css","/static/css/legacy_packages/components-vflaHmNdE.css","/static/css/components/button-vfldKQ35-.css","/static/css/scooter/scooter-scoped-vflWuydQl.css","/static/css/recaptcha_challenge-vflrcf67y.css","/static/css/recaptcha_v2_challenge-vfl5GXpO2.css"]);o.LoginOrRegisterModal=T});
//# sourceMappingURL=modal.min.js-vfl5xtv0N.map
define(["require","exports","tslib","react","classnames","spectrum/tertiary_link","spectrum/tooltip","spectrum_comments/comment","spectrum_comments/thread/thread_editor","prop-types","spectrum_comments/comment_editor/draft_utils","spectrum_comments/comment_utils"],function(e,t,o,n,r,i,s,a,c,d,l,m){"use strict";function h(e,t){return{onDeleted:function(){return t.onCommentDeleted(e.id)},onEdited:function(o){return t.onCommentEdited(e.id,o)},onMentionsQueryUpdated:t.onMentionsQueryUpdated,onClickTimeCode:t.onClickTimeCode,onClickOlderInfo:t.onClickOlderInfo}}Object.defineProperty(t,"__esModule",{value:!0});var p=function(){},u=function(e,t){var o=t.localization,r=e.count,i=o.threadCollapsedCommentsText(r);return n.createElement("div",{className:"sc-thread-comment-number"},i)};u.contextTypes={localization:d.object};var f={type:"no_details"},v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isEditorEmpty:!0,isEditorFocused:!1,shouldFocusThreadEditor:!1},t.onFocus=function(){return t.setState({isEditorFocused:!0})},t.onBlur=function(){return t.setState({isEditorFocused:!1})},t.onClick=function(){var e=t.props;(0,e.onThreadInteractedWith)(e.thread)},t.handleKeyDown=function(e){13===e.which&&t.onClick()},t.onEditorStateChange=function(e){l.hasFocus(e)&&t.props.actions.onEditorFocused(),t.props.actions.onEditorStateChange(e),t.setState({isEditorEmpty:l.contentIsEmpty(e)})},t.setRef=function(e){t.ref=e},t.renderMarkedAsResolved=function(e){var o,r,i=t.localization,a=(t.props.user,"with_details"===e.type&&e);return a&&i.markedAsResolvedByUserLabel&&i.getActingTime?(o=i.markedAsResolvedByUserLabel(a.resolver.name.display),r=i.getActingTime(a.resolvedTimestamp)):(o=i.markedAsResolvedLabel,r=i.markedAsResolvedLabel),n.createElement(s.Tooltip,{positioning:"above",tooltipContent:r},n.createElement("div",{className:"sc-thread-controls-resolved-note"},o))},t.getResolvedInfo=function(e){var t=e.resolvedInfo,o=e.resolved;return t?t:o?f:void 0},t.onStickerSelected=function(e,o,n){(0,t.props.actions.onReply)({metadata:[{type:"sticker",id:e,url:o,name:n}],text:n})},t}return o.__extends(t,e),Object.defineProperty(t.prototype,"localization",{get:function(){return this.context.localization},enumerable:!0,configurable:!0}),t.prototype.componentDidMount=function(){this.props.active&&this.scrollToThread(!1)},t.prototype.componentDidUpdate=function(e){if(this.props.active&&!e.active){var t=this.props.streamSettings.canComment;this.scrollToThread(t)}else!this.props.active&&e.active&&this.setState({isEditorFocused:!1,shouldFocusThreadEditor:!1})},t.prototype.scrollToThread=function(e){var t=this,o=this.props.scrollToElem,n=this.ref;n&&o&&o(n).then(function(){t.ref&&t.setState({shouldFocusThreadEditor:e})})},Object.defineProperty(t.prototype,"innerRef",{get:function(){return this.ref},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeOrEditorHasText",{get:function(){return this.props.active||!this.state.isEditorEmpty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){var e=this.props,t=e.className,o=void 0===t?"":t,n=e.thread,i=e.isMobile,s=e.hover,a=n.resolved||n.resolvedInfo;return r(o,{"sc-thread":!0,"sc-thread-active":this.activeOrEditorHasText,"sc-thread-inactive":!this.activeOrEditorHasText,"sc-thread-read":n.read,"sc-thread-unread":!n.read,"sc-thread-resolved":a,"sc-thread-unresolved":!a,"sc-thread-mobile":i,"sc-thread-hover":s,"sc-thread-editor-is-focused":this.state.isEditorFocused})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filteredReplies",{get:function(){var e=this.props.thread.comments;e[0];return e.slice(1).filter(function(e){return!e.deleted})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includeEditor",{get:function(){var e=this.props,t=e.streamSettings,o=e.isMobile;return t.canShowEditor&&!o},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDisabled",{get:function(){return!!this.props.thread.pending},enumerable:!0,configurable:!0}),t.prototype.renderComment=function(e,t,o,r){void 0===o&&(o=a.Comment);var i=this.props,s=i.actions,c=i.editedComment,d=i.mentionsMatches,l=i.onStartEdit,p=i.onEndEdit,u=i.isMobile,f=i.showRevisionInfo,v=!!c&&e.id===c.id;return t||(e=m.truncateComment(e)),n.createElement(o,{actions:h(e,s),active:t,annotation:r,comment:e,key:e.id,isEditing:v,onStartEdit:l,onEndEdit:p,mentionsMatches:d,isMobile:u,showRevisionInfo:f})},t.prototype.renderReadToggle=function(){var e=this.localization,t=this.props,o=t.actions,r=t.thread,a=r.read?o.onMarkAsUnread:o.onMarkAsRead,c=r.read?e.markAsUnreadLabel:e.markAsReadLabel;return n.createElement(s.Tooltip,{positioning:"above",tooltipContent:c},n.createElement(i.TertiaryLink,{className:"sc-thread-toggle",onClick:a,disabled:this.isDisabled},c))},t.prototype.renderToplineControls=function(){var e=this.localization,t=this.props,o=t.streamSettings,r=t.isMobile,a=t.actions,c=t.thread,d=this.activeOrEditorHasText;if(r)return null;var l=d&&o.canModifyThreads,m=this.getResolvedInfo(c);return m?n.createElement("div",{className:"sc-thread-controls"},this.renderMarkedAsResolved(m),l&&n.createElement(s.Tooltip,{positioning:"above",tooltipContent:e.threadRestoreLabel},n.createElement(i.TertiaryLink,{className:"sc-thread-toggle",disabled:this.isDisabled,onClick:a.onUnresolve},e.threadRestoreLabel))):l?n.createElement("div",{className:"sc-thread-controls"},this.renderReadToggle(),n.createElement(s.Tooltip,{positioning:"above",tooltipContent:e.threadResolveLabel},n.createElement(i.TertiaryLink,{className:"sc-thread-toggle",onClick:a.onResolve,disabled:this.isDisabled},e.threadResolveLabel))):null},Object.defineProperty(t.prototype,"createStickerProps",{get:function(){return{stickerPacks:this.props.stickerPacks,onStickerSelected:this.onStickerSelected}},enumerable:!0,configurable:!0}),t.prototype.renderActive=function(){var e=this,t=this.localization,o=this.props,r=o.actions,i=r.onMentionsQueryUpdated,s=r.onMouseEnter,d=r.onMouseLeave,l=r.onReply,m=o.commentComponent,h=o.mentionsMatches,p=o.onCancel,u=o.thread,f=o.user,v=this.filteredReplies,E=this.createStickerProps;return n.createElement("li",{onMouseEnter:s,onMouseLeave:d,className:this.className,tabIndex:0,"aria-expanded":!0,"aria-label":u.read?t.a11yCommentThreadLabel:t.a11yUnreadCommentThreadLabel,ref:this.setRef,onClick:this.onClick},this.renderToplineControls(),n.createElement("ul",{className:"sc-thread-comments"},this.renderComment(u.comments[0],this.activeOrEditorHasText,m,u.annotation),v.map(function(t){return e.renderComment(t,!0,a.Comment)})),this.includeEditor&&n.createElement(c.ThreadEditor,{author:f,disabled:this.isDisabled,shouldFocus:this.state.shouldFocusThreadEditor,mentionsMatches:h,onCancel:p,onEditorStateChange:this.onEditorStateChange,onMentionsQueryUpdated:i,onPost:l,onFocus:this.onFocus,onBlur:this.onBlur,stickerProps:E}))},t.prototype.renderInactive=function(){var e=this.localization,t=this.props,o=t.actions,r=o.onMouseEnter,i=o.onMouseLeave,s=t.active,c=t.commentComponent,d=void 0===c?a.Comment:c,l=t.mentionsMatches,h=t.thread,f=t.isMobile,v=t.showRevisionInfo,E=this.filteredReplies;return n.createElement("li",{className:this.className,tabIndex:0,"aria-label":h.read?e.a11yCommentThreadLabel:e.a11yUnreadCommentThreadLabel,"aria-expanded":!1,onClick:this.onClick,onKeyDown:this.handleKeyDown,onMouseEnter:r,onMouseLeave:i,ref:this.setRef},this.renderToplineControls(),n.createElement("ul",{className:"sc-thread-comments"},this.renderComment(h.comments[0],s,d,h.annotation),E.length>1&&n.createElement(u,{count:E.length-1}),E.length>0&&n.createElement(a.Comment,{active:!1,comment:m.truncateComment(E[E.length-1]),actions:{onClickTimeCode:p,onDeleted:p,onEdited:p,onMentionsQueryUpdated:p,onClickOlderInfo:p},mentionsMatches:l,onEndEdit:p,onStartEdit:p,isEditing:!1,isMobile:f,showRevisionInfo:v})),this.includeEditor&&n.createElement("div",{className:"sc-thread-reply-hint"},this.localization.replyHintLabel||"Replyâ€¦"))},t.prototype.render=function(){return this.props.thread.comments.every(function(e){return!!e.deleted})?null:this.activeOrEditorHasText?this.renderActive():this.renderInactive()},t.contextTypes={localization:d.object},t})(n.PureComponent);t.Thread=v});
//# sourceMappingURL=thread.min.js-vflRpXvUh.map